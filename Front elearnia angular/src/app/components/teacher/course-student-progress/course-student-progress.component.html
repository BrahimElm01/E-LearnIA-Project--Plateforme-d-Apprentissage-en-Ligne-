<div class="progress-container">
  <!-- App Bar -->
  <div class="app-bar">
    <div class="app-bar-content">
      <div>
        <h1>Progression des Ã©tudiants</h1>
        <p>{{ course()?.title || 'Chargement...' }}</p>
      </div>
      <div class="app-bar-actions">
        <button class="icon-btn" (click)="navigateBack()" title="Retour">
          <span class="icon">â†</span>
        </button>
        <button class="icon-btn" (click)="navigateBack()" title="Accueil">
          <span class="icon">ğŸ </span>
        </button>
      </div>
    </div>
  </div>

  <div class="content">
    @if (isLoading()) {
      <div class="loading">Chargement de la progression...</div>
    } @else if (errorMessage()) {
      <div class="error-message">
        <p>{{ errorMessage() }}</p>
        <button class="btn btn-primary" (click)="loadStudentProgress()">RÃ©essayer</button>
      </div>
    } @else if (students().length === 0) {
      <div class="info-message">
        <p>Aucun Ã©tudiant inscrit Ã  ce cours pour le moment.</p>
      </div>
    } @else {
      <div class="stats-summary">
        <div class="stat-card">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-value">{{ students().length }}</div>
          <div class="stat-label">Ã‰tudiants inscrits</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">âœ…</div>
          <div class="stat-value">{{ getCompletedCount() }}</div>
          <div class="stat-label">Cours terminÃ©s</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-value">{{ getAverageProgressFormatted() }}%</div>
          <div class="stat-label">Progression moyenne</div>
        </div>
      </div>

      <div class="students-table">
        <div class="table-header">
          <div class="col-name">Ã‰tudiant</div>
          <div class="col-email">Email</div>
          <div class="col-progress">Progression</div>
          <div class="col-status">Statut</div>
          <div class="col-rating">Note</div>
          <div class="col-actions">Actions</div>
        </div>
        
        @for (student of students(); track student.studentId) {
          <div class="table-row">
            <div class="col-name">
              <div class="student-name">{{ student.fullName }}</div>
            </div>
            <div class="col-email">
              <div class="student-email">{{ student.email }}</div>
            </div>
            <div class="col-progress">
              <div class="progress-bar-container">
                <div class="progress-bar" [style.width.%]="student.progress" [style.background-color]="getProgressColor(student.progress)"></div>
                <span class="progress-text">{{ formatProgress(student.progress) }}%</span>
              </div>
            </div>
            <div class="col-status">
              @if (student.completed) {
                <span class="badge badge-success">âœ… TerminÃ©</span>
              } @else {
                <span class="badge badge-in-progress">ğŸ”„ En cours</span>
              }
            </div>
            <div class="col-rating">
              @if (student.rating) {
                <div class="rating">
                  <span class="stars">{{ getRatingStars(student.rating) }}</span>
                  <span class="rating-value">({{ formatRating(student.rating) }})</span>
                </div>
              } @else {
                <span class="no-rating">Non notÃ©</span>
              }
            </div>
            <div class="col-actions">
              <button 
                class="action-btn reset-progress-btn" 
                (click)="resetStudentProgress(student.studentId)"
                title="RÃ©initialiser la progression Ã  0%">
                ğŸ”„ RÃ©initialiser progression
              </button>
              <button 
                class="action-btn reset-btn" 
                (click)="resetQuizAttempts(student.studentId)"
                title="RÃ©initialiser les tentatives de quiz">
                ğŸ“ RÃ©initialiser tentatives
              </button>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
