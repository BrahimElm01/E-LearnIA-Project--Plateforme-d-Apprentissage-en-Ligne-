<div class="analytics-container">
  <!-- App Bar -->
  <div class="app-bar">
    <div class="app-bar-content">
      <div>
        <div class="header-top">
          <button class="back-btn" (click)="navigateBack()" title="Retour Ã  l'accueil">
            â† Retour
          </button>
        </div>
        <h1>Mes analyses</h1>
        <p>Vue d'ensemble de votre progression</p>
      </div>
      <div class="app-bar-actions">
        <button class="icon-btn" (click)="navigateToHome()" title="Accueil">
          <span class="icon">ğŸ </span>
        </button>
      </div>
    </div>
  </div>

  <div class="content">
    @if (isLoading()) {
      <div class="loading">Chargement de vos statistiques...</div>
    } @else {
      <!-- Statistiques principales -->
      <div class="stats-grid">
        <div class="stat-card main-stat">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-info">
            <div class="stat-value">{{ formatProgress(averageProgress()) }}%</div>
            <div class="stat-label">Progression moyenne</div>
          </div>
          <div class="progress-ring">
            <svg class="progress-svg" viewBox="0 0 100 100">
              <circle class="progress-bg" cx="50" cy="50" r="45"></circle>
              <circle 
                class="progress-circle" 
                cx="50" 
                cy="50" 
                r="45"
                [style.stroke]="getProgressColor(averageProgress())"
                [style.stroke-dasharray]="(averageProgress() * 2.827) + ' 282.7'">
              </circle>
            </svg>
            <div class="progress-text">{{ formatProgress(averageProgress()) }}%</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ğŸ“š</div>
          <div class="stat-info">
            <div class="stat-value">{{ totalCourses() }}</div>
            <div class="stat-label">Total des cours</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">âœ…</div>
          <div class="stat-info">
            <div class="stat-value">{{ completedCourses() }}</div>
            <div class="stat-label">Cours complÃ©tÃ©s</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ğŸ”„</div>
          <div class="stat-info">
            <div class="stat-value">{{ inProgressCourses() }}</div>
            <div class="stat-label">En cours</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ğŸ“–</div>
          <div class="stat-info">
            <div class="stat-value">{{ notStartedCourses() }}</div>
            <div class="stat-label">Non commencÃ©s</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">ğŸ¯</div>
          <div class="stat-info">
            <div class="stat-value">{{ formatProgress(getCompletionRate()) }}%</div>
            <div class="stat-label">Taux de complÃ©tion</div>
          </div>
        </div>
      </div>

      <!-- Graphique de rÃ©partition -->
      <div class="chart-section">
        <h2 class="section-title">RÃ©partition des cours</h2>
        <div class="chart-container">
          <div class="chart-item">
            <div class="chart-bar-container">
              <div 
                class="chart-bar completed" 
                [style.height.%]="totalCourses() > 0 ? (completedCourses() / totalCourses()) * 100 : 0">
                <span class="chart-value">{{ completedCourses() }}</span>
              </div>
            </div>
            <div class="chart-label">ComplÃ©tÃ©s</div>
          </div>
          <div class="chart-item">
            <div class="chart-bar-container">
              <div 
                class="chart-bar in-progress" 
                [style.height.%]="totalCourses() > 0 ? (inProgressCourses() / totalCourses()) * 100 : 0">
                <span class="chart-value">{{ inProgressCourses() }}</span>
              </div>
            </div>
            <div class="chart-label">En cours</div>
          </div>
          <div class="chart-item">
            <div class="chart-bar-container">
              <div 
                class="chart-bar not-started" 
                [style.height.%]="totalCourses() > 0 ? (notStartedCourses() / totalCourses()) * 100 : 0">
                <span class="chart-value">{{ notStartedCourses() }}</span>
              </div>
            </div>
            <div class="chart-label">Non commencÃ©s</div>
          </div>
        </div>
      </div>

      <!-- DÃ©tails par cours -->
      @if (courses().length > 0) {
        <div class="courses-detail-section">
          <h2 class="section-title">Progression dÃ©taillÃ©e par cours</h2>
          <div class="courses-list">
            @for (course of courses(); track course.id) {
              <div class="course-progress-item">
                <div class="course-info">
                  <h3>{{ course.title }}</h3>
                  <p class="teacher">Par {{ course.teacherName }}</p>
                </div>
                <div class="course-progress">
                  <div class="progress-bar">
                    <div 
                      class="progress-fill" 
                      [style.width.%]="getLimitedProgress(course.progress)"
                      [style.background-color]="getProgressColor(getLimitedProgress(course.progress))">
                    </div>
                  </div>
                  <div class="progress-info">
                    <span class="progress-percentage">{{ formatProgress(course.progress) }}%</span>
                    @if (getLimitedProgress(course.progress) >= 100) {
                      <span class="status-badge completed">âœ… TerminÃ©</span>
                    } @else if (course.progress > 0) {
                      <span class="status-badge in-progress">ğŸ”„ En cours</span>
                    } @else {
                      <span class="status-badge not-started">ğŸ“– Non commencÃ©</span>
                    }
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      } @else {
        <div class="empty-state">
          <div class="empty-icon">ğŸ“Š</div>
          <h2>Aucun cours disponible</h2>
          <p>Vous n'Ãªtes inscrit Ã  aucun cours pour le moment.</p>
          <button class="btn-primary" (click)="navigateToCourses()">Voir les cours</button>
        </div>
      }
    }
  </div>
</div>
